@model ProjectViewModel

@{
    ViewData["Title"] = "Projects";
    ViewData["NavLinkActive"] = "linkProjects";
}

<section class="ui dark home segment">
    <section class="ui basic segment" style="margin-left: 300px; min-height: 400px;">
        <section class="ui left attached rail" style="background-color: var(--colour-scheme-dark);">
            <section class="ui basic segment">
                <section class="ui form">
                    <h3 class="ui dividing header">Filter</h3>
                    <section class="field">
                        <label>Name</label>
                        <input id="inputName" type="text" placeholder="Name" />
                    </section>
                    <section class="field">
                        <label>Tags</label>
                        <div class="ui multiple search selection dropdown">
                            <input id="inputTags" type="hidden" />
                            <div class="default text">Tag Filter</div>
                            <i class="dropdown icon"></i>
                            <div class="menu">
                                @foreach(var tag in Model.AllTags.OrderBy(t => t))
                                {
                                    <div class="item" data-value="@tag">@tag</div>
                                }
                            </div>
                        </div>
                    </section>
                </section>
            </section>
        </section>
        <section id="divProjects" class="ui basic segment">
            <partial name="_ProjectContentPartial" model="Model.Content" />
        </section>
    </section>
</section>

@section Scripts {
    <script>
        $(".ui.dropdown").dropdown();
    </script>

    <script>
        function refreshProjects() {
            let name = document.getElementById("inputName").value;
            let tags = document.getElementById("inputTags").value;
            let div = document.getElementById("divProjects");

            window.history.pushState({}, null, "/Home/Projects?name="+name+"&tags="+tags);

            div.classList.add("loading");
            $.ajax({
                type: "POST",
                url: "/Home/AjaxGetFilteredProjectsHtml",
                contentType: "application/json",
                dataType: "html",
                data: JSON.stringify({ name: name, tags: tags })
            })
            .done(function (html) {
                div.classList.remove("loading");
                div.innerHTML = html;
            });
        }

        document.getElementById("inputTags").addEventListener('change', refreshProjects);
        document.getElementById("inputName").addEventListener('change', refreshProjects);
    </script>
 }